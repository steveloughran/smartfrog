<?xml version="1.0"?>

<!--
/*
 Service Location Protocol - SmartFrog components.
 Copyright (C) 2004 Glenn Hisdal <ghisdal(a)c2i.net>
 
 This library is free software; you can redistribute it and/or
 modify it under the terms of the GNU Lesser General Public
 License as published by the Free Software Foundation; either
 version 2.1 of the License, or (at your option) any later version.
 
 This library is distributed in the hope that it will be useful,
 but WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 Lesser General Public License for more details.
 
 You should have received a copy of the GNU Lesser General Public
 License along with this library; if not, write to the Free Software
 Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 
 This library was originally developed by Glenn Hisdal at the 
 European Organisation for Nuclear Research (CERN) in Spring 2004. 
 The work was part of a master thesis project for the Norwegian 
 University of Science and Technology (NTNU).
 
 For more information: http://home.c2i.net/ghisdal/slp.html 
 */
-->

<project name="slplib" default="dist" basedir=".">

<description>
Introduction
============
The build script for the SLP library.
To run the build script, ant must be installed
and the ant executable should be in the system path.

The SLP library enables SmartFrog components to be advertised
and located using the Service Location Protocol.


Installing the build tools
==========================
Please go though the installation guide and install ant 1.6 or later.
Reference URL:http://ant.apache.org

</description>

    <!-- override point -->
  <property file="build.properties" />
  <property name="root.dir" location="../../"  />


  <!-- Import common stuff -->
  <!--available file="../../common.xml" property="root.dir" value="../.."/--> 
  <import file="${root.dir}/common.xml"/>

  <property name="is.component" value="true"  />
  <!-- =================================================================== -->
  <!-- Initialization target                                               -->
  <!-- =================================================================== -->
    <target name="init" depends="init-standard-output-dirs,use-smartfrog-tasks">
    <tstamp/>
    <property name="Name.System" value="slplib"/>
    <property name="Name.Author" value="Copyright (C) 2004 Glenn Hisdal"/>
    <property name="version" value="smartfrog components"/>
    <property name="Version" value="1.00.000.beta"/>
    <property name="year" value="2004"/>

    <echo message=""/>
    <echo message="==================================================================="/>
    <echo message="= ${Name.System} ${version}"/>
    <echo message="= ${Name.Author} "/>
    <echo message="==================================================================="/>
    <echo message=""/>
    <echo message="(${ant.version})"/>
    <available property="nice.task.present" classname="org.apache.tools.ant.taskdefs.Nice" />
  </target>

  <!-- =================================================================== -->
  <!-- Help on usage                                                       -->
  <!-- =================================================================== -->
  <target name="help" depends="init" description="Help">
    <echo message=""/>
    <echo message="-------------------------------------------------------------"/>
    <echo message="${Name.System} ${version} Build file"/>
    <echo message="-------------------------------------------------------------"/>
    <echo message="* General:  "/>
    <echo message="    build        --> recompiles and creates all packages"/>
    <echo message="    dist         --> prepares distribution package (Default)"/>
    <echo message="    compile      --> compiles the contributed source code"/>
    <echo message="    clean        --> restores the distribution to its clean state"/>
    <echo message="   "/>
    <echo message="    help --> this help"/>
    <echo message="See the comments inside the build.xml file for more details."/>
    <echo message="-------------------------------------------------------------"/>
    <echo message=""/>
  </target>


  <!-- =================================================================== -->
  <!-- Global properties                                                   -->
  <!-- =================================================================== -->
    <!-- override point -->
    <property file="build.properties" />
    <property environment="env" />
    <property file="build-postenv.properties" />

    <!-- Release Directories -->
   
   

    <!--property name="redist" value="redist"/ -->

    <property name="examplesFiles" value="org/smartfrog/examples/**/*"/>
     <!-- a list of files for rmic -->
    <property name="rmitargets" value="${basedir}/rmitargets"/>

    <!-- Compile options for Smartfrog Release -->
    <property name="javac.debug.mode" value="on"/> <!-- turn on compile -g -->
    <property name="javac.debug.level" value="lines,vars,source" />
    <property name="javac.runtime.target" value="1.4" />



    <!-- Security related files
    =================================================================
    <property name="manifestName" value="${private}/sealManifest.mf"/>
    =================================================================-->


  <!-- =================================================================== -->
  <!--  Release                                                            -->
  <!-- =================================================================== -->
  <target name="release"  depends="clean, dist, jdocs" description="Creates clean new release">
  </target>

  <!-- =================================================================== -->
  <!--                                                                     -->
  <!-- =================================================================== -->
  <target name="initbuild"  depends="init">
    <mkdir dir="${build}"/>
    <mkdir dir="${build.classes.dir}"/>
  </target>

  <!-- =================================================================== -->
  <!--                                                                     -->
  <!-- =================================================================== -->
  <target name="initdist" depends="init">
    <mkdir dir="${dist.dir}"/>
    <mkdir dir="${dist.lib.dir}"/>
    <mkdir dir="${dist.bin.dir}"/>
    <mkdir dir="${dist.docs.dir}"/>
    <mkdir dir="${dist.src.dir}"/>
  </target>



  <!-- =================================================================== -->
  <!--   Copy .sf files to "build" directories                             -->
  <!-- =================================================================== -->
  <target name="copySF" depends="initbuild">
    <copy todir="${build.classes.dir}">
      <fileset dir="${src.dir}">
        <include name="**/*.sf*" />
      </fileset>
    </copy>
  </target>

  <!-- =================================================================== -->
  <!--   Copy .bat files to "build" directories                            -->
  <!-- =================================================================== -->
  <target name="copyBAT" depends="initbuild">
    <copy todir="${build.classes.dir}">
      <fileset dir="${src.dir}">
        <include name="**/*.bat*" />
      </fileset>
    </copy>
  </target>

  <!-- =================================================================== -->
  <!--   Copy .html files to "build" directories                           -->
  <!-- =================================================================== -->
  <target name="copyHTML" depends="initbuild">
    <copy todir="${build.classes.dir}">
      <fileset dir="${src.dir}">
        <include name="**/*.htm*" />
      </fileset>
    </copy>
  </target>

  <!-- =================================================================== -->
  <!--  Copy Gif files to "build" directories                              -->
  <!-- =================================================================== -->
  <target name="copyGif" depends="initbuild">
    <copy todir="${build.classes.dir}">
      <fileset dir="${src.dir}">
        <include name="**/*.gif" />
      </fileset>
    </copy>
  </target>


  <!-- =================================================================== -->
  <!--                                                                     -->
  <!-- =================================================================== -->
  <target name="copylibs" depends="initdist">
    <copy todir="${dist.lib.dir}">
      <fileset dir="${lib}">
        <include name="**/*.jar" />
      </fileset>
    </copy>
  </target>




  <!-- =================================================================== -->
  <!--                                                                     -->
  <!-- =================================================================== -->
  <target name="copybins" depends="initdist">
    <copy todir="${dist.bin.dir}">
      <fileset dir="${bin}">
        <include name="**/*" />
        <exclude name="**/*.bak" />
        <exclude name="**/tools" />
      </fileset>
    </copy>
   <chmod dir="${dist.bin.dir}"
          perm="ugo+rx"
          excludes="**/*.ico, **/*.ini, **/*.sf*"/>
  </target>




  <!-- =================================================================== -->
  <!--                                                                     -->
  <!-- =================================================================== -->
  <target name="copydocs" depends="initdist">
    <copy todir="${dist.docs.dir}">
      <fileset dir="${docs}">
	<include name="**/*.pdf" />
      </fileset>
    </copy>
  </target>



  <!-- =================================================================== -->
  <!--   JDocs                                                             -->
  <!-- =================================================================== -->
  <target name="jdocs" depends="initdist" description="Generates the API documentation">
    <!--  Java Docs for all                                                -->
    <echo message=""/>
    <echo message="------------------------------------------------------------------------"/>
    <echo message="  Creating Java Docs for ${Name.System} ${version} [${dist.dir}/${jdocs}]"/>
    <echo message="------------------------------------------------------------------------"/>
    <mkdir dir="${dist.jdocs.dir}"/>
    <javadoc packagenames="org.smartfrog.services.comm.slp.*"
           sourcepath="${src.dir}"
           destdir="${dist.jdocs.dir}"
           author="true"
           version="true"
           use="true"
           breakiterator="true"
           windowtitle="${Name.System}"
           Header="${Name.System} ${Version}"
           Footer="${Name.System} ${version} ${Version}"
           doctitle="${Name.System}"
           bottom="${Name.Author}"
           source="${javac.runtime.target}"
           >
      <group title="SmartFrog Packages" packages="org.smartfrog.*"/>
      <classpath>
          <fileset dir="${core.smartfrog.lib}">
              <include name="**/*.jar"/>
          </fileset>
      </classpath>
    </javadoc>

  </target>


  <!-- =================================================================== -->
  <!--  BUILD                                                              -->
  <!-- =================================================================== -->

  <target name="build" depends="initbuild,compile,copySF,copyGif,copyBAT,copyHTML"
      description="Recompile and create all packages"/>

  <!-- =================================================================== -->
  <!--  Jar Files                                                              -->
  <!-- =================================================================== -->

  <!--  slplib.jar                                               -->
  <target name="slplibJar" depends="build">
    <jar jarfile="${dist.lib.dir}/sfSlp.jar"
         basedir="${build.classes.dir}"
	 includes="**/slp/**"/>
     <mkdir dir="build/dist/lib"/>
     <copy file="${dist.lib.dir}/sfSlp.jar" todir="build/dist/lib"/>
     <copy todir="build/dist/lib">
	     <fileset dir="lib">
		     <include name="**/*.jar"/>
	     </fileset>
     </copy>
  </target>


  <target name="jars" depends="initdist, slplibJar"/>
  <!-- =================================================================== -->
  <!-- Initialization path for SF Libs                                     -->
  <!-- =================================================================== -->
  <path id="smartfrog.run.class.path">
       <pathelement location="${core.smartfrog.lib}/smartfrog.jar"/>
       <pathelement location="${core.smartfrog.lib}/sfServices.jar"/>
       <pathelement location="${core.smartfrog.lib}/sfExamples.jar"/>
       <pathelement location="${dist.lib.dir}/sfSlp.jar"/>
  </path>


  <!-- =================================================================== -->
  <!--  DIST                                                               -->
  <!-- =================================================================== -->
  <!--target name="dist"
    depends="build,initdist,jars,copylibs,copybins,copydocs,sfParseTest"
    description="Prepares distribution package">
  </target-->

	<target name="dist" depends="common.dist" description="create the jar files">
	 <copy todir = "${dist.lib.dir}">
        <fileset dir ="${lib.dir}" />
    </copy> 
	
	</target>

  <!-- =================================================================== -->
  <!-- clean                                                               -->
  <!-- =================================================================== -->
  <target name="clean" depends="init"  description="Restores the distribution to its clean state">
    <!-- Delete the ${build} ${dist.dir} ${jdocs} directory trees -->
    <!-- remove parser source files -->
    <delete dir="${build}"/>
    <delete dir="${dist.dir}"/>
  </target>


  <!-- =================================================================== -->
  <!-- a clean distribution                                               -->
  <!-- =================================================================== -->
  <target name="fromclean" depends="clean,dist"/>



    <!-- =================================================================== -->
    <!-- sfParse parsertargets                                                -->
    <!-- =================================================================== -->
    <target name="sfParseTest"  depends="build,jars">
      <java classname="org.smartfrog.SFParse"
          failonerror="true" fork="true"
          classpathref="smartfrog.run.class.path">
        <arg value="-R"/>
        <!--<arg value="-r"/> -->
        <arg value="-q"/>
        <arg value="-f"/>
        <arg file="parsertargets"/>
     </java>
    </target>


</project>

<!-- End of file -->
