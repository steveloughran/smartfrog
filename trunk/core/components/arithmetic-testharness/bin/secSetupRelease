#!/bin/bash
# ./secSetupRelease <release_zip> <CAdir> <host1dir> <host2dir> ....
export TOP=$PWD
export REL=$1
shift
export CADIR=$1
#first is the CA
mkdir $TOP/$CADIR
#cp $TOP/$REL $TOP/$CADIR
cd $TOP/$CADIR
jar xvf $TOP/$REL
ant initCA
ant signJars
export 
shift
for x in $@;
do 
  ant newDaemon
done
#one dir per daemon
export allhosts=`ls private | grep host`
jar cvf $TOP/all.jar *
cd $TOP

for h in $allhosts;
 do 
    export x=$1
    mkdir $PWD/$x
    cd $PWD/$x
    jar xvf $TOP/all.jar
    cd private
#rename my host to local
    mv $h local
#cleanup the test
    rm -fr CA host*
    cd $TOP
    shift
 done


