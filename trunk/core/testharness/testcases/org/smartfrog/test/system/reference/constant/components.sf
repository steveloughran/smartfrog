/** (C) Copyright 2007 Hewlett-Packard Development Company, LP

This library is free software; you can redistribute it and/or
modify it under the terms of the GNU Lesser General Public
License as published by the Free Software Foundation; either
version 2.1 of the License, or (at your option) any later version.

This library is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
Lesser General Public License for more details.

You should have received a copy of the GNU Lesser General Public
License along with this library; if not, write to the Free Software
Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA

For more information: www.smartfrog.org

*/

#include "/org/smartfrog/services/assertions/components.sf"
#include "/org/smartfrog/functions.sf"

tests "org.smartfrog.test.system.reference.constant.ConstantReferenceTest";

errors extends {
  Constant "org.smartfrog.sfcore.reference.ConstantReferencePart";
  CLASS_NOT_FOUND CONSTANT "org.smartfrog.sfcore.reference.ConstantReferencePart.CLASS_NOT_FOUND";
  FIELD_NOT_FOUND CONSTANT "org.smartfrog.sfcore.reference.ConstantReferencePart.FIELD_NOT_FOUND";
  ILLEGAL_ACCESS CONSTANT "org.smartfrog.sfcore.reference.ConstantReferencePart.ILLEGAL_ACCESS";
  NOT_A_STATIC_FIELD CONSTANT "org.smartfrog.sfcore.reference.ConstantReferencePart.NOT_A_STATIC_FIELD";
}

ExpectResolutionFailure extends ExpectDeployFailure {
  description "a test that expects the resolution to fail";

  reference TBD;
  lazyref LAZY reference;
  error TBD;
  undeployAfter 1000;
  startupTimeout 1000;

  //the action is an assertion, one we expect to fail
  action extends Assert {
    prim PARENT;
    attribute "lazyref";
    sfShouldTerminate true;
  }

  //the exception that is looked for
  exceptions [[SmartFrogExceptionNames:EXCEPTION_RESOLUTION,error]];

}


testBadClass extends ExpectResolutionFailure {
  reference CONSTANT "no.such.class";
  error errors:CLASS_NOT_FOUND;
}

testBadField extends ExpectResolutionFailure {
  reference CONSTANT "org.smartfrog.test.system.reference.constant.ConstantReferenceTest.no-such-field";
  error errors:CLASS_NOT_FOUND;
}

testNoValue extends ExpectResolutionFailure {
  reference CONSTANT "";
  error errors:CLASS_NOT_FOUND;
}

testTooShort extends ExpectResolutionFailure {
  reference CONSTANT "...";
  error errors:CLASS_NOT_FOUND;
}

testIllegalAccess extends ExpectResolutionFailure {
  reference CONSTANT "org.smartfrog.test.system.reference.constant.ConstantReferenceTest.PRIVATE_STATIC_STRING";
  error errors:ILLEGAL_ACCESS;
}

testNotStatic extends ExpectResolutionFailure {
  reference CONSTANT "org.smartfrog.test.system.reference.constant.ConstantReferenceTest.PUBLIC_STRING";
  error errors:NOT_A_STATIC_FIELD;
}

testResolveConstant extends ExpectResolutionFailure {
  reference CONSTANT "org.smartfrog.test.system.reference.constant.ConstantReferenceTest.PUBLIC_STATIC_STRING";
  exitType "normal";
}


