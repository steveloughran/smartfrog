<?xml version="1.0"?>
<!--
/** (C) Copyright 1998-2004 Hewlett-Packard Development Company, LP

This library is free software; you can redistribute it and/or
modify it under the terms of the GNU Lesser General Public
License as published by the Free Software Foundation; either
version 2.1 of the License, or (at your option) any later version.

This library is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
Lesser General Public License for more details.

You should have received a copy of the GNU Lesser General Public
License along with this library; if not, write to the Free Software
Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA

For more information: www.smartfrog.org

*/
-->
<!DOCTYPE project [
     <!ENTITY security SYSTEM "./private/buildSecurity.xml">
]>

<!-- ===========================================================================
Introduction
============
To use: ant -f buildRelease release

Installing the build tools
==========================
To Be Written

-->
<project name="SmartFrog" default="process" basedir=".">

  <!-- =================================================================== -->
  <!-- Initialization target                                               -->
  <!-- =================================================================== -->
  <target name="init">
    <tstamp/>
    <property name="Name.Framework" value="SmartFrog Framework"/>
    <property name="Name.System" value="SmartFrog"/>
    <property name="Name.Company" value="(C) Copyright 1998-2004 Hewlett-Packard Development Company, LP"/>
    <!--property name="version" value="3.04.014.beta"/-->
    <property name="year" value="2004"/>

    <echo message=""/>
    <echo message="==================================================================="/>
    <echo message="= ${Name.Framework} - ${Name.Company} "/>
    <echo message="==================================================================="/>
  </target>

  <!-- =================================================================== -->
  <!-- Help on usage                                                       -->
  <!-- =================================================================== -->
  <target name="help" depends="init" description="Process">
    <echo message=""/>
    <echo message="-------------------------------------------------------------"/>
    <echo message="${Name.Framework} Release file"/>
    <echo message="-------------------------------------------------------------"/>
    <echo message="* General:  "/>
    <echo message="    help         --> this message"/>
    <echo message="    process      --> step by step release guide"/>
    <echo message="    release      --> generates zip file and javaInstaller for release packages"/>
    <echo message="   "/>
    <echo message="    help --> this help"/>
    <echo message="            See the comments inside the build.xml file for more details."/>
    <echo message="-------------------------------------------------------------"/>
    <echo message=""/>
  </target>

  <!-- =================================================================== -->
  <!-- Help on usage                                                       -->
  <!-- =================================================================== -->
  <target name="process" depends="init" description="Help">
    <echo message=""/>
    <echo message="-------------------------------------------------------------"/>
    <echo message=" Step by step guide to make a release"/>
    <echo message="-------------------------------------------------------------"/>
    <echo message="  1. a) Change version in buildRelease.xml file to new release name"/>
    <echo message="         release in this file: ${version}"/>
    <echo message="     b) Change version in build.xml file to new release name"/>
    <echo message="     c) Change version in releaseBuild.xml file to new release name"/>
    <echo message=" "/>
    <echo message="  2. Change version in file org.smarfrog.version.java"/>
    <echo message=" "/>
    <echo message=" "/>
    <echo message="  3. Change documentation version (if updated):"/>
    <echo message=" 	    - Check sfReference.doc"/>
    <echo message="         - Check sfUserManual.doc"/>
    <echo message="         - Generate PDF: sfReference.pdf"/>
    <echo message="         - Generate PDF: sfUserManual.pdf"/>
    <echo message=" "/>
    <echo message="  4. Tag cvs with new version using: "/>
    <echo message="         Ex. cvs tag release3_01_003_alpha "/>
    <echo message=" "/>
    <echo message="  5. Clean checkout with tag: "/>
    <echo message="         Ex. cvs checkout -r release3_02_000_alpha core"/>
    <echo message=" "/>
    <echo message="  6. Build new release: "/>
    <echo message="         Go to fresh module directory and run:"/>
    <echo message="             ant release "/>
    <echo message="             ant -f buildRelease.xml release"/>
    <echo message=" "/>
    <echo message="  7. Check content of zip and dist files: "/>
    <echo message="         Ex. SRC distribution: 'build.xml dist' "/>
    <echo message="                               'dist\build.xml build'  "/>
    <echo message="                               'dist\build.xml jdocs'  "/>
    <echo message="         Ex. BIN distribution: 'dist\build.xml build'  "/>
    <echo message="                               'dist\build.xml jdocs'"/>
    <echo message=" "/>
    <echo message="  8. Upload files to web site."/>
    <echo message=" "/>
    <echo message="  Note: to retag something add move tag parameter:"/>
    <echo message="         Ex. cvs tag -F release3_01_001_alpha buildRelease.xml"/>
    <echo message="        to remove tag something add move tag parameter:"/>
    <echo message="         Ex. cvs tag -d release3_01_001_alpha buildRelease.xml"/>
    <echo message="-------------------------------------------------------------"/>
    <echo message=""/>
  </target>

  <!-- =================================================================== -->
  <!-- Initialization path (Libs needed for compiling)                     -->
  <!-- =================================================================== -->
  <path id="smartfrog.class.path">
       <pathelement path="${classpath}"/>
  </path>

  <!-- =================================================================== -->
  <!-- Global properties                                                   -->
  <!-- =================================================================== -->
      <!-- Release Directories -->
     <property name="bin" value="bin"/>           <!-- where the source is -->
     <property name="src" value="src"/>           <!-- where the source is -->
     <property name="dist" value="dist"/>         <!-- where the files to zip go -->
     <property name="releases" value="releases"/> <!-- where the dated zips go, don't clean -->
     <property name="lib" value="lib"/>
     <property name="docs" value="docs"/>
     <property name="examples" value="examples"/>
     <property name="examplesSrc" value="src"/>
     <property name="dist.lib.dir" location="${dist}/${lib}"/>

     <property name="examplesFiles" value="org/smartfrog/examples/**/*"/>
       <!-- a list of files for rmic -->
     <property name="rmitargets" value="${basedir}/rmitargets"/>

     <property name="unix-executables" value="**/*.sh,**/*.pl,**/*.py" />
     <property name="dos-executables" value="**/*.bat,**/*.cmd" />
     <property name="default" value="**/default*" />
     
  <!-- =================================================================== -->
  <!-- FixCRLF for different platforms                                     -->
  <!-- =================================================================== -->
  <target name="fixCRLF">
     <!-- OS dependant -->
     <fixcrlf srcdir="${dist}/${bin}"
       includes="**/**"
       excludes="${dos-executables},${windows-executables},${default}"
     />
     <!-- OS dependant -->
     <fixcrlf srcdir="${dist}/${bin}"
       tab="remove"
       tablength="4"
       includes="${default}"
     />
     <!-- Windows/Dos format -->
     <fixcrlf srcdir="${dist}/${bin}"
       eol="crlf"
       includes="${dos-executables}"
     />
     <!-- Unix format -->
     <fixcrlf srcdir="${dist}/${bin}"
       eol="lf"
       includes="${unix-executables}"
     />
     
     <!-- OS dependant -->
     <fixcrlf srcdir="${dist}"
       includes="**/*.txt"
     />
  </target>

  <!-- =================================================================== -->
  <!-- initrelease                                                             -->
  <!-- =================================================================== -->
  <target name="initrelease">
	  <mkdir dir="../releases"/>
       <java classname="org.smartfrog.Version"
	 failonerror="true" fork="true"
	 outputproperty="version">
	 <arg value="-b"/>
	 <classpath>
	    <fileset dir="${dist.lib.dir}">
        		<include name="**/*.jar"/>
      	    </fileset>
	 </classpath>
      </java>
      <!--copy todir="${dist.lib.dir}">
	 <fileset dir="${dist.lib.dir}">
		 <include name="**/*.jar"/>
	 </fileset>
	 <mapper type="glob" from="*.jar" to="*-${version}.jar"/>
     </copy-->

     <!--copy todir="${lib}">
	 <fileset dir="${lib}">
		 <include name="**/*.jar"/>
	 </fileset>
	 <mapper type="glob" from="*.jar" to="*-${version}.jar"/>
     </copy-->
  </target>
  <!-- =================================================================== -->
  <!-- release                                                             -->
  <!-- =================================================================== -->
  <target name="release" depends="init, initrelease, fixCRLF" description="Creates zip with release packages">
    <zip destfile="../releases/${Name.System}.${version}.${DSTAMP}_DIST.zip">
       <zipfileset dir="." prefix="${Name.System}.${version}">
	  <include name="${dist}/**"/>
	  <!--exclude name="${dist}/lib/**"/-->
          <exclude name="${dist}/docs/**"/>
          <exclude name="${dist}/classes/**"/>
       </zipfileset>
       <zipfileset dir="." prefix="${Name.System}.${version}">
        <include name="${dist}/docs/sfUserManual.pdf"/>
        <include name="${dist}/docs/build.html"/>
        <include name="${dist}/docs/DefaultParser.html"/>
        <include name="${dist}/docs/dir.JPG"/>
        <include name="${dist}/docs/sfReference.pdf"/>
        <include name="${dist}/docs/sfDynamicWebServerExample.pdf"/>
        <include name="${dist}/docs/jdocs/**"/>
       </zipfileset>
       <!--zipfileset dir="." prefix="${Name.System}.${version}">
	  <include name="${dist}/lib/**/*-${version}.jar"/>
       </zipfileset-->
    </zip>

    <zip destfile="../releases/${Name.System}.${version}.${DSTAMP}_ALL.zip">
       <zipfileset dir="." prefix="${Name.System}.${version}">
        <include name="bin/**"/>
        <include name="docs/sfUserManual.pdf"/>
        <include name="docs/build.html"/>
        <include name="docs/DefaultParser.html"/>
        <include name="docs/dir.JPG"/>
        <include name="docs/sfReference.pdf"/>
        <include name="docs/sfDynamicWebServerExample.pdf"/>
	<include name="lib/**"/>
	<!--include name="lib/**/*-${version}.jar"/>
	<include name="lib/readme.txt"/-->
        <include name="src/**"/>
        <include name="private/**"/>
        <include name="testCA/**"/>
        <include name="javacc/*"/>
        <include name="build.xml"/>
        <include name="releaseBuild.xml"/>
        <include name="rmitargets"/>
        <include name="rmitargetsExamples"/>
        <include name="parsertargets"/>
        <include name="COPYRIGHT.txt"/>
        <include name="LICENSE.txt"/>
        <include name="changes.txt"/>
        <include name="readme.txt"/>
        <exclude name="**/CVS" />
        <exclude name="**/*.dfPackage" />
        <exclude name="**/Cvs" />
        <exclude name="**/.#*" />
        <exclude name="**/*.*~" />
        <include name="../testharness/build.xml"/>
        <include name="../testharness/testcases/build.xml"/>
       </zipfileset>
       <zipfileset dir="." prefix="${Name.System}.${version}">
	  <include name="${dist}/**"/>
	  <!--exclude name="${dist}/lib/**"/-->
          <exclude name="${dist}/docs/**"/>
          <exclude name="${dist}/classes/**"/>
       </zipfileset>
       <zipfileset dir="." prefix="${Name.System}.${version}">
        <include name="${dist}/docs/sfUserManual.pdf"/>
        <include name="${dist}/docs/build.html"/>
        <include name="${dist}/docs/DefaultParser.html"/>
        <include name="${dist}/docs/dir.JPG"/>
        <include name="${dist}/docs/sfReference.pdf"/>
        <include name="${dist}/docs/sfDynamicWebServerExample.pdf"/>
        <include name="${dist}/docs/jdocs/**"/>
       </zipfileset>
       <!--zipfileset dir="." prefix="${Name.System}.${version}">
	  <include name="${dist}/lib/**/*-${version}.jar"/>
       </zipfileset-->
    </zip>
     <tar tarfile="../releases/${Name.System}.${version}.${DSTAMP}_DIST.tar" >
       <tarfileset dir="." prefix="${Name.System}.${version}">
         <include name="${dist}/bin/**/*.sf"/>
         <include name="${dist}/bin/**/*.bat"/>
         <include name="${dist}/bin/**/*.ini"/>
        </tarfileset>
       <tarfileset dir="." prefix="${Name.System}.${version}" >
         <exclude name="${dist}/bin/**"/>
	 <include name="${dist}/**"/>
	 <!--exclude name="${dist}/lib/**"/-->
         <exclude name="${dist}/classes/**"/>
         <exclude name="${dist}/docs/**"/>
        </tarfileset>
      <tarfileset dir="." prefix="${Name.System}.${version}">
        <include name="${dist}/docs/sfUserManual.pdf"/>
        <include name="${dist}/docs/build.html"/>
        <include name="${dist}/docs/DefaultParser.html"/>
        <include name="${dist}/docs/dir.JPG"/>
        <include name="${dist}/docs/sfReference.pdf"/>
        <include name="${dist}/docs/sfDynamicWebServerExample.pdf"/>
        <include name="${dist}/docs/jdocs/**"/>
       </tarfileset>
       <!--tarfileset dir="." prefix="${Name.System}.${version}">
	  <include name="${dist}/lib/**/*-${version}.jar"/>
       </tarfileset-->
       <tarfileset dir="." mode="755" prefix="${Name.System}.${version}">
         <include name="${dist}/bin/**"/>
         <exclude name="${dist}/bin/**/*.sf"/>
         <exclude name="${dist}/bin/**/*.bat"/>
         <exclude name="${dist}/bin/**/*.ini"/>
        </tarfileset>
     </tar>
    <gzip src="../releases/${Name.System}.${version}.${DSTAMP}_DIST.tar" zipfile="../releases/${Name.System}.${version}.${DSTAMP}_DIST.tar.gz"/>
    <delete file="../releases/${Name.System}.${version}.${DSTAMP}_DIST.tar"/>

    <tar tarfile="../releases/${Name.System}.${version}.${DSTAMP}_ALL.tar">
      <tarfileset dir="." prefix="${Name.System}.${version}">
        <include name="bin/**/*.sf"/>
        <include name="bin/**/*.bat"/>
        <include name="bin/**/*.ini"/>
        <include name="docs/sfUserManual.pdf"/>
        <include name="docs/build.html"/>
        <include name="docs/DefaultParser.html"/>
        <include name="docs/dir.JPG"/>
        <include name="docs/sfReference.pdf"/>
        <include name="docs/sfDynamicWebServerExample.pdf"/>
	<include name="lib/**"/>
	<!--include name="lib/*-${version}.jar"/>
	<include name="lib/readme.txt"/-->
        <include name="src/**"/>
        <include name="private/**"/>
        <include name="testCA/**"/>
        <include name="javacc/*"/>
        <include name="build.xml"/>
        <include name="releaseBuild.xml"/>
        <include name="rmitargets"/>
        <include name="rmitargetsExamples"/>
        <include name="parsertargets"/>
        <include name="COPYRIGHT.txt"/>
        <include name="LICENSE.txt"/>
        <include name="changes.txt"/>
        <include name="readme.txt"/>
        <exclude name="**/CVS" />
        <exclude name="**/*.dfPackage" />
        <exclude name="**/Cvs" />
        <exclude name="bin/tools/**"/>
        <exclude name="**/.#*" />
        <exclude name="**/*.*~" />
        <include name="../testharness/build.xml"/>
        <include name="../testharness/testcases/build.xml"/>
       </tarfileset>
       <tarfileset dir="." prefix="${Name.System}.${version}" mode="755">
        <include name="bin/**"/>
        <exclude name="bin/**/*.sf"/>
        <exclude name="bin/**/*.bat"/>
        <exclude name="bin/**/*.ini"/>
       </tarfileset>

       <tarfileset dir="." prefix="${Name.System}.${version}">
         <include name="${dist}/bin/**/*.sf"/>
         <include name="${dist}/bin/**/*.bat"/>
         <include name="${dist}/bin/**/*.ini"/>
        </tarfileset>
       <tarfileset dir="." prefix="${Name.System}.${version}">
         <exclude name="${dist}/bin/**"/>
	 <include name="${dist}/**"/>
	 <!--exclude name="${dist}/lib/**"/-->
         <exclude name="${dist}/classes/**"/>
         <exclude name="${dist}/classes/**"/>
         <exclude name="${dist}/docs/**"/>
        </tarfileset>
      <tarfileset dir="." prefix="${Name.System}.${version}">
        <include name="${dist}/docs/sfUserManual.pdf"/>
        <include name="${dist}/docs/build.html"/>
        <include name="${dist}/docs/DefaultParser.html"/>
        <include name="${dist}/docs/dir.JPG"/>
        <include name="${dist}/docs/sfReference.pdf"/>
        <include name="${dist}/docs/sfDynamicWebServerExample.pdf"/>
        <include name="${dist}/docs/jdocs/**"/>
       </tarfileset>
       <!--tarfileset dir="." prefix="${Name.System}.${version}">
	  <include name="${dist}/lib/**/*-${version}.jar"/>
       </tarfileset-->
       <tarfileset dir="." mode="755" prefix="${Name.System}.${version}">
         <include name="${dist}/bin/**"/>
         <exclude name="${dist}/bin/**/*.sf"/>
         <exclude name="${dist}/bin/**/*.bat"/>
         <exclude name="${dist}/bin/**/*.ini"/>
        </tarfileset>
    </tar>
    <gzip src="../releases/${Name.System}.${version}.${DSTAMP}_ALL.tar" zipfile="../releases/${Name.System}.${version}.${DSTAMP}_ALL.tar.gz"/>
    <delete file="../releases/${Name.System}.${version}.${DSTAMP}_ALL.tar"/>
<!--
    <zip destfile="../${Name.System}.${version}.${DSTAMP}_JDOCS.zip">
       <zipfileset dir="." prefix="${Name.System}.${version}">
        <include name="${dist}/docs/jdocs/**"/>
       </zipfileset>
    </zip>
     <tar tarfile="../${Name.System}.${version}.${DSTAMP}_JDOCS.tar" >
      <tarfileset dir="." prefix="${Name.System}.${version}">
        <include name="${dist}/docs/jdocs/**"/>
       </tarfileset>
     </tar>
    <gzip src="../${Name.System}.${version}.${DSTAMP}_JDOCS.tar" zipfile="../${Name.System}.${version}.${DSTAMP}_JDOCS.tar.gz"/>
    <delete file="../${Name.System}.${version}.${DSTAMP}_JDOCS.tar"/>
    -->
    
    <!--delete>
	  <fileset dir="${lib}" includes="**/*-${version}.jar"/>
     </delete-->
  </target>
</project>

<!-- End of file -->
