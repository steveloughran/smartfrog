<?xml version="1.0"?>
<!--
/** (C) Copyright 1998-2004 Hewlett-Packard Development Company, LP

This library is free software; you can redistribute it and/or
modify it under the terms of the GNU Lesser General Public
License as published by the Free Software Foundation; either
version 2.1 of the License, or (at your option) any later version.

This library is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
Lesser General Public License for more details.

You should have received a copy of the GNU Lesser General Public
License along with this library; if not, write to the Free Software
Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA

For more information: www.smartfrog.org

*/
-->
<!DOCTYPE project [
     <!ENTITY security SYSTEM "./private/buildSecurity.xml">
]>

<!-- ===========================================================================
Introduction
============
Makes testharness release for windows and Linux platforms. 
Also includes core/extras/ant and common.xml as these are required to 
execute Junit test cases in testharness but as of now smartfrog release 
does not contain extras/ant and common.xml.
TODO: Change the script once SmartFrog release contains ant tasks.
To use: ant -f buildRelease release
-->
<project name="testHarness" default="process">

  <!-- =================================================================== -->
  <!-- Initialization target                                               -->
  <!-- =================================================================== -->
  <target name="init">
    <tstamp/>
    <property name="Name.Testharness" value="SmartFrog Testharness"/>
    <property name="Name.System" value="testharness"/>
    <property name="Name.Company" value="(C) Copyright 1998-2004 Hewlett-Packard Development Company, LP"/>
    <property name="version" value="3.02.002.beta"/>
    <property name="year" value="2004"/>

    <property name="root.dir" location=".."  />
    
    <echo message=""/>
    <echo message="==================================================================="/>
    <echo message="= ${Name.Testharness} - ${Name.Company} "/>
    <echo message="==================================================================="/>
  </target>

  <!-- =================================================================== -->
  <!-- Help on usage                                                       -->
  <!-- =================================================================== -->
  <target name="help" depends="init" description="Process">
    <echo message=""/>
    <echo message="-------------------------------------------------------------"/>
    <echo message="${Name.Testharness} Release file"/>
    <echo message="-------------------------------------------------------------"/>
    <echo message="* General:  "/>
    <echo message="    help         --> this message"/>
    <echo message="    process      --> step by step release guide"/>
    <echo message="    release      --> generates zip and gz file for release packages"/>
    <echo message="   "/>
    <echo message="    help --> this help"/>
    <echo message="            See the comments inside the build.xml file for more details."/>
    <echo message="-------------------------------------------------------------"/>
    <echo message=""/>
  </target>

  <!-- =================================================================== -->
  <!-- Help on usage                                                       -->
  <!-- =================================================================== -->
  <target name="process" depends="init" description="Help">
    <echo message=""/>
    <echo message="-------------------------------------------------------------"/>
    <echo message=" Step by step guide to make a release"/>
    <echo message="-------------------------------------------------------------"/>
    <echo message="  1. a) Change version in buildRelease.xml file to new release name"/>
    <echo message="         release in this file: ${version}"/>
    <echo message=" "/>
    <echo message="  2. Build new release: "/>
    <echo message="         Go to fresh module directory and run:"/>
    <echo message="             ant -f buildRelease.xml release"/>
    <echo message=" "/>
    <echo message="-------------------------------------------------------------"/>
    <echo message=""/>
  </target>

  <!-- =================================================================== -->
  <!-- initrelease                                                             -->
  <!-- =================================================================== -->
  <target name="initrelease">
    <mkdir dir="../releases"/>
  </target>

  <target name="copy-file">
      <copy file="${root.dir}/common.xml" todir="."/>
      <copy todir="./extras/ant">
          <fileset dir="${root.dir}/extras/ant">
              <exclude name="**/Cvs"/>
          </fileset>
      </copy>
	  <!--copydir src="${root.dir}/extras" dest="./extras" excludes="**/Cvs"/ -->
  </target>
  <!-- =================================================================== -->
  <!-- release                                                             -->
  <!-- =================================================================== -->
  <target name="release" depends="init, initrelease, copy-file" description="Creates zip with release packages"> 
   <zip destfile="../releases/${Name.System}.${version}.${DSTAMP}.zip">
       <zipfileset dir="." prefix="${Name.System}.${version}">
          <include name="common.xml"/>
          <include name="docs/ExceptionTestCases.xls"/>
          <include name="docs/JunitHarness.html"/>
          <include name="docs/RSTestHarness.doc"/>
          <include name="docs/SystemTestCases.xls"/>
          <include name="docs/XP_and_junit.ppt"/>
          <include name="test/**"/>
          <include name="testcases/**"/>
          <include name="testcases/build.xml"/>
          <include name="extras/**"/>
          <include name="build.xml"/>
          <include name="buildRelease.xml"/>
          <include name="rmitargets"/>
          <exclude name="**/SVN" />
          <exclude name="**/*.dfPackage" />
          <exclude name="**/Cvs" />
          <exclude name="**/.#*" />
          <exclude name="**/*.*~" />
       </zipfileset>
   </zip>
    
   <tar tarfile="../releases/${Name.System}.${version}.${DSTAMP}.tar">
      <tarfileset dir="." prefix="${Name.System}.${version}">
        <include name="docs/ExceptionTestCases.xls"/>
        <include name="docs/JunitHarness.html"/>
        <include name="docs/RSTestHarness.doc"/>
        <include name="docs/SystemTestCases.xls"/>
        <include name="docs/XP_and_junit.ppt"/>
        <include name="test/**"/>
        <include name="testcases/**"/>
        <include name="testcases/build.xml"/>
        <include name="extras/**"/>
        <include name="common.xml"/>
        <include name="build.xml"/>
        <include name="buildRelease.xml"/>
        <include name="rmitargets"/>
        <exclude name="**/SVN" />
        <exclude name="**/*.dfPackage" />
        <exclude name="**/Cvs" />
        <exclude name="**/.#*" />
        <exclude name="**/*.*~" />
      </tarfileset>
  </tar>
  
  <gzip src="../releases/${Name.System}.${version}.${DSTAMP}.tar" zipfile="../releases/${Name.System}.${version}.${DSTAMP}.tar.gz"/>
  <delete file="../releases/${Name.System}.${version}.${DSTAMP}.tar"/>

  <delete file="common.xml"/>
  <delete dir="extras"/>
  </target>
</project>

<!-- End of file -->
