<?xml version="1.0"?>
<project name="parse" default="teardown">

  <description>
    Tests for the parse.

    command line invocation
    ant -lib ..\..\build\dist\lib\smartfrog-tasks.jar -lib ..\..\..\..\smartfrog\dist\lib\smartfrog.jar -lib
    ..\..\..\..\smartfrog\dist\lib\sfExamples.jar -f undeploy.xml testResource

    ant -lib ../../build/dist/lib/smartfrog-tasks.jar -lib ../../../../smartfrog/dist/lib/smartfrog.jar -f undeploy.xml
    testNoParams

    ant -lib ../../build/dist/lib/smartfrog-tasks.jar -lib ../../../../smartfrog/dist/lib/smartfrog.jar -lib
    ../../../../smartfrog/dist/lib/sfExamples.jar -f undeploy.xml testResource
  </description>

  <import file="test-common.xml"/>

  <!-- at the end of every execution, we force a cleanup -->
  <target name="teardown">
    <sf-stopdaemon failonerror="false"/>
    <sf-stopdaemon failonerror="false" port="${new.port}"/>
  </target>

  <target name="testNoParams">
    <sf-ping/>
  </target>

  <target name="testNoFailure">
    <sf-ping failonerror="false" successProperty="pinged"/>
  </target>

  <target name="testEmptyApplication">
    <sf-ping application=""/>
  </target>


  <target name="testBadHost">
    <sf-ping host="no-such-hostname" application="test"/>
  </target>


  <target name="testRootProcess">
    <parallel>
      <sf-startdaemon timeout="${long.timeout}" failonerror="true">
      </sf-startdaemon>
      <sequential>
        <sf-block/>
        <fail if="block.timeout">No daemon started</fail>
        <sf-ping application="rootProcess" timeout="${medium.timeout}"
            failonerror="false" successProperty="pinged" diagnostics="true"/>
        <sf-stopdaemon/>
      </sequential>
    </parallel>
  </target>


  <target name="testDifferentPort">
    <parallel>
      <sf-startdaemon timeout="${long.timeout}" failonerror="true"
          port="${new.port}">
      </sf-startdaemon>
      <sequential>
        <sf-block2/>
        <fail if="block.timeout">No daemon started</fail>
        <sf-ping application="rootProcess" timeout="${medium.timeout}"
            port="${new.port}"
            failonerror="false" successProperty="pinged"/>
        <sf-stopdaemon port="${new.port}"/>
      </sequential>
    </parallel>
  </target>

  <target name="testUnknownComponent">
    <parallel>
      <sf-startdaemon timeout="${long.timeout}" failonerror="true">
      </sf-startdaemon>
      <sequential>
        <sf-block/>
        <fail if="block.timeout">No daemon started</fail>
        <sf-ping application="undeployedApp" timeout="${medium.timeout}"
            failonerror="false" successProperty="pinged"/>
        <sf-stopdaemon/>
      </sequential>
    </parallel>
  </target>

</project>
