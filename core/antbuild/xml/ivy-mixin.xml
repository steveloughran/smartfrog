<project name="ivy" 
    xmlns:ivy="antlib:fr.jayasoft.ivy.ant">

  <description>
    These targets extend compile-and-jar with extra states and transitions,
    to do pom-based builds.
  </description>

  
  <import file="core.xml"/>

  <!--define the published state-->
  <target name="published" depends="ivy-publish-all"/>


  <target name="ivy-init" depends="init-core,load-version-info,artifact-names">
    <property name="ivy.dir" location="${root.dir}/antbuild/ivy" />
    <typedef uri="antlib:fr.jayasoft.ivy.ant" onerror="fail"
             resource="fr/jayasoft/ivy/ant/antlib.xml">
      <classpath>
        <pathelement location="${ivy.dir}/lib/ivy-${ivy.version}.jar"/>
      </classpath>
    </typedef>
    <fail >
      <condition >
        <not>
          <typefound uri="antlib:fr.jayasoft.ivy.ant" name="retrieve"/>
        </not>
      </condition>
      You need the ivy tasks from http://www.jayasoft.org/ivy/download
      ivy.jar should be installed in ANT_HOME/lib or ${user.home}/.ant/lib
    </fail>
    <!--copy ivy artifacts -->
    <property name="ivy.lib.dir" location="${build.dir}/ivy/lib" />
    <ivy:configure file="${ivy.dir}/ivyconf.xml"/>
    <property name="ivy.artifact.retrieve.pattern"
        value="[conf]/[artifact]-[revision].[ext]"/>
    <property name="ivy.publish.pattern"
        value="[artifact]-[revision].[ext]"/>
  </target>

  <target name="ivy-resolve" depends="ivy-init">
    <ivy:resolve />
  </target>

  <target name="ivy-retrieve" depends="ivy-resolve">
    <ivy:retrieve pattern="${ivy.lib.dir}/${ivy.artifact.retrieve.pattern}" sync="true" />
  </target>

  <target name="ivy-report" depends="ivy-resolve">
    <ivy:report todir="${build.dir}/ivy/report"/>
  </target>

  <target name="ready-to-publish" depends="state.ready-to-publish,ivy-report"/>

  <target name="ivy-publish" depends="ready-to-publish-all,ready-to-publish,ivy-resolve">
    <ivy:publish resolver="local" pubrevision="${artifact.version}"
        overwrite="true"
        artifactspattern="${dist.dir}/lib/${ivy.publish.pattern}" />
  </target>

  <target name="ready-to-publish-all" depends="ready-to-publish,documents-processed"/>

  <target name="ivy-publish-all" depends="ivy-publish">
  </target>
  <!--
    this target does the local install, copy
  -->

  <target name="ivy-install" depends="ivy-publish"
      description="Component built and installed locally"/>

  <target name="ivy-published" depends="ivy-publish" />


</project>