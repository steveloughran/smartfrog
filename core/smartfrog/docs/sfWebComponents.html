<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta content="Apache Forrest" name="Generator">
<meta name="Forrest-version" content="0.7">
<meta name="Forrest-skin-name" content="pelt">
<title>sfWebComponents</title>
<link type="text/css" href="skin/basic.css" rel="stylesheet">
<link media="screen" type="text/css" href="skin/screen.css" rel="stylesheet">
<link media="print" type="text/css" href="skin/print.css" rel="stylesheet">
<link type="text/css" href="skin/profile.css" rel="stylesheet">
<script src="skin/getBlank.js" language="javascript" type="text/javascript"></script><script src="skin/getMenu.js" language="javascript" type="text/javascript"></script><script src="skin/fontsize.js" language="javascript" type="text/javascript"></script>
<link rel="shortcut icon" href="">
</head>
<body onload="init()">
<script type="text/javascript">ndeSetTextSize();</script>
<div id="top">
<div class="breadtrail">
<script src="skin/breadcrumbs.js" language="JavaScript" type="text/javascript"></script>
</div>
<div class="header">
<div class="grouplogo">
<a href="http://www.SmartFrog.org/"><img class="logoImage" alt="SmartFrog" src="images/group.png" title="SmartFrog"></a>
</div>
<div class="projectlogoA1">
<a href="http://www.SmartFrog.org"><img class="logoImage" alt="" src="images/frog.gif"></a>
</div>
<ul id="tabs">
<li>
<a class="base-not-selected" href="index.html">Home</a>
</li>
<li>
<a class="base-not-selected" href="sfcore.html">SmartFrog Core</a>
</li>
<li>
<a class="base-not-selected" href="comp.html">Components</a>
</li>
<li>
<a class="base-not-selected" href="anttasks.html">Ant Tasks</a>
</li>
<li>
<a class="base-not-selected" href="extras.html">Extras</a>
</li>
<li>
<a class="base-not-selected" href="examples.html">Examples</a>
</li>
<li>
<a class="base-not-selected" href="jdocs_index.html">Java Docs</a>
</li>
<li>
<a class="base-not-selected" href="Copyright.html">Copyright</a>
</li>
<li>
<a class="base-not-selected" href="lpgl.html">License Terms</a>
</li>
</ul>
</div>
</div>
<div id="main">
<div id="publishedStrip">
<div id="level2tabs"></div>
<script type="text/javascript"><!--
document.write("<text>Last Published:</text> " + document.lastModified);
//  --></script>
</div>
<div class="breadtrail">
             
             &nbsp;
           </div>
<div id="content">
<h1>sfWebComponents</h1>
<div class="abstract"></div>
<div id="minitoc-area">
<ul class="minitoc">
<li>
<a href="#SmartFrog+Web+Components">SmartFrog Web Components</a>
<ul class="minitoc">
<li>
<a href="#"></a>
</li>
<li>
<a href="#Architecture">Architecture</a>
</li>
<li>
<a href="#Implementation">Implementation</a>
</li>
<li>
<a href="#Components">Components</a>
<ul class="minitoc">
<li>
<a href="#ApplicationServer">ApplicationServer</a>
</li>
<li>
<a href="#ApplicationServerContext">ApplicationServerContext</a>
</li>
<li>
<a href="#WebApplication">WebApplication</a>
</li>
<li>
<a href="#ServletContext">ServletContext</a>
</li>
<li>
<a href="#Servlet">Servlet</a>
</li>
<li>
<a href="#-N101D1"></a>
</li>
<li>
<a href="#LivenessPage">LivenessPage</a>
</li>
</ul>
</li>
<li>
<a href="#ServletContext+Components">ServletContext Components</a>
<ul class="minitoc">
<li>
<a href="#MimeType">MimeType</a>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<a name="N1000C"></a><a name="SmartFrog+Web+Components"></a>
<h2 class="boxed">SmartFrog Web Components</h2>
<div class="section">
<a name="N10011"></a>
<h3 class="boxed"></h3>
<div class="frame fixme">
<div class="label">Fixme (openoffice-common2forrest template)</div>
<div class="content">
          The previous heading is more than one level below the heading before it. To remove this fixme, correct the structuring of your document.
        </div>
</div>
<p class="Text body">The SmartFrog Web components provide a set of components for defining web applications (WAR applications), Enterprise (EAR) applications and Servlets for deployment onto a Java Application Server such as JBoss, WebLogic or Apache Geronmio, or a Java Web Server such as Jetty or Tomcat. It also includes a liveness page component, that can retrieve an HTTP page from a server as its liveness test, integrating web page visiblity with application liveness.</p>
<p class="Text body">These components are still a work in progress, with the consequent warning that all interfaces and component descriptions are unstable. Furthermore, at some point in future, the components are likely to move to a self contained library, provisionally sf-www.jar.</p>
<p class="Text body">The goal is to enable abstract descriptions of WAR, EAR and servlet applications which can then be deployed directly to any application server. To this end, the descriptions of application and web servers are abstract -they cannot be instantiated. A non-abstract implementation of the server component descriptions is needed to deploy WAR/EAR/Servlet applications. </p>
<p class="Text body">At the time of writing, the sole implementation uses Jetty, in the separate sf-jetty component </p>
<p class="Standard"></p>
<a name="N10026"></a><a name="Architecture"></a>
<h3 class="boxed">Architecture</h3>
<p class="Text body">An <span class="T1">ApplicationServer</span><span class="T2"> represents the web server or app server into which Web applications may be deployed. Different application server implementations extend this template to provide support for deploying such items. The specific types of deployable </span><span class="T1">ApplicationServerContext</span><span class="T2"> are:</span>
</p>
<ul>
<li>
<p class="P1">WAR file: a web application. All implementations should support this. Declared in a a <span class="T1">WebApplication</span> component.</p>
</li>
<li>
<p class="P1">EAR file: an Enterprise application, which requires a full J2EE system.</p>
</li>
<li>
<p class="P1">SAR file: (currently) JBoss specific service application.</p>
</li>
<li>
<p class="P1">Servlet Context: a context into which individual servlets can be declared. This is not as self contained as the others, but permits much more low-level configuration within SmartFrog deployment descriptors themselves, so eliminating much of the need for WAR file and web.xml configuration descriptor. Declared in a <span class="T1">ServletContext</span> component. Items that may be deployed within such a context must extend <span class="T1">ServletContextComponent</span>, the two standard options being <span class="T1">Servlet</span> and <span class="T1">MimeType</span>. These components have a <span class="code characters">context</span> attribute that must be bound to the context into which they are to be deployed.</p>
</li>
</ul>
<p class="instruction">Other extensions of <span class="T1">ApplicationServerContext</span> may also be created and deployed into a server. </p>
<p class="instruction">Every <span class="T1">ApplicationServerContext</span> must be bound to an ApplicationServer; this is done by setting the <span class="code characters">server</span> attribute to a <span class="code characters">LAZY</span> reference to the specific server. </p>
<p class="instruction">When dynamically deploying applications to an application server, the full URL to the specific servlet, SOAP endpoint or other part of the system may be unknown until deployment time. For this reason, every component that can be deployed has an <span class="code characters">absolutePath</span> attribute. This is set at run-time to the full path of the specific component.</p>
<p class="instruction"></p>
<p class="instruction"></p>
<a name="N10084"></a><a name="Implementation"></a>
<h3 class="boxed">Implementation</h3>
<p class="Text body">
<span class="T2">The ApplicationServer component is abstract; specific implementations are needed for every supported application server. These implementations provide implementation-specific classes to deploy components within the server. Each component that be deployed within an application server, and each servlet deployed within a SservletContext, must have a matching </span><span class="T1">delegate</span><span class="T2"> class provided by the server-specific implementation. The portable components used in the deployment descriptors retrieve these delegate implementations from the server to which they are bound, and the heavy lifting of deployment is then delegated to the implementations. </span>
</p>
<p class="instruction">The effect of this design is that one can describe WAR, EAR, SAR files and servlet applications within deployment descriptors, and deploy these applications to different application servers, merely binding them to different target systems.</p>
<p class="instruction"></p>
<a name="N10099"></a><a name="Components"></a>
<h3 class="boxed">Components</h3>
<a name="N1009E"></a><a name="ApplicationServer"></a>
<h4>ApplicationServer</h4>
<p class="Text body">This is an abstract type that different application servers must extend/implement. </p>
<table class="ForrestTable" cellspacing="1" cellpadding="4">
<caption>Table3</caption>
<tr>
<th>Attribute Name</th><th>Description</th><th>Optional/Mandatory</th>
</tr>
<tr>
<td>supportsWAR</td><td>Boolean that indicates whether or not this server supports WAR files (i.e .Web applications)</td><td>Mandatory</td>
</tr>
<tr>
<td>supportsServletContext</td><td>Boolean that indicates whether or not this server supports servlet contexts</td><td>Mandatory</td>
</tr>
<tr>
<td>supportsEAR</td><td>Boolean that indicates whether or not this server supports EAR files.</td><td>Mandatory</td>
</tr>
<tr>
<td>supportsSAR</td><td>Boolean that indicates whether or not this server supports SAR files.</td><td>Mandatory</td>
</tr>
</table>
<p class="Text body"></p>
<a name="N100CE"></a><a name="ApplicationServerContext"></a>
<h4>ApplicationServerContext</h4>
<p class="Text body">Base template/interface for anything that can be deployed into an application server</p>
<table class="ForrestTable" cellspacing="1" cellpadding="4">
<caption>Table11</caption>
<tr>
<th>Attribute Name</th><th>Description</th><th>Optional/Mandatory</th>
</tr>
<tr>
<td>server</td><td>LAZY reference to the server to which this context is bound</td><td>Mandatory</td>
</tr>
</table>
<p class="Text body"></p>
<p class="Text body">Run-time properties</p>
<table class="ForrestTable" cellspacing="1" cellpadding="4">
<caption>Table12</caption>
<tr>
<th>Attribute Name</th><th>Description</th>
</tr>
<tr>
<td>absolutePath</td><td>Base path of this context within the application server. This is the path exposed as part of the URL</td>
</tr>
</table>
<p class="Text body"></p>
<a name="N100FB"></a><a name="WebApplication"></a>
<h4>WebApplication</h4>
<p class="Text body">Declares a web application</p>
<table class="ForrestTable" cellspacing="1" cellpadding="4">
<caption>Table5</caption>
<tr>
<th>Attribute Name</th><th>Description</th><th>Optional/Mandatory</th>
</tr>
<tr>
<td>contextPath</td><td>Context Path for the web application</td><td>Mandatory</td>
</tr>
<tr>
<td>warFile</td><td>Path of the web application</td><td>Mandatory</td>
</tr>
<tr>
<td>resourceId</td><td>Resource id for the web application</td><td>Optional</td>
</tr>
<tr>
<td>server</td><td>Server to which this web application is attached</td><td>Mandatory</td>
</tr>
</table>
<p class="Text body"></p>
<p class="Text body">Run-time properties</p>
<table class="ForrestTable" cellspacing="1" cellpadding="4">
<caption>Table10</caption>
<tr>
<th>Attribute Name</th><th>Description</th>
</tr>
<tr>
<td>absolutePath</td><td>Base path of this context</td>
</tr>
</table>
<p class="Text body"></p>
<a name="N1013D"></a><a name="ServletContext"></a>
<h4>ServletContext</h4>
<table class="ForrestTable" cellspacing="1" cellpadding="4">
<caption>Table6</caption>
<tr>
<th>Attribute Name</th><th>Description</th><th>Optional/Mandatory</th>
</tr>
<tr>
<td>contextPath</td><td>Context Path for the servlet context</td><td>Mandatory</td>
</tr>
<tr>
<td>resourceBase</td><td>Directory containing static files and JSP pages base for the servlet context</td><td>Mandatory</td>
</tr>
<tr>
<td>server</td><td>Server to which this servlet context is attached </td><td>Mandatory</td>
</tr>
<tr>
<td>classPath</td><td>Classpath for the servlet context</td><td>Optional</td>
</tr>
</table>
<p class="Text body"></p>
<p class="Text body">Run-time properties</p>
<table class="ForrestTable" cellspacing="1" cellpadding="4">
<caption>Table7</caption>
<tr>
<th>Attribute Name</th><th>Description</th>
</tr>
<tr>
<td>ipaddr</td><td>IP Address of the context (currently determined from the network card/address that the SmartFrog daemon is listening on)</td>
</tr>
<tr>
<td>absolutePath</td><td>Base path of this context</td>
</tr>
</table>
<p class="Text body"></p>
<a name="N10181"></a><a name="Servlet"></a>
<h4>Servlet</h4>
<p class="Text body">Declares a servlet </p>
<table class="ForrestTable" cellspacing="1" cellpadding="4">
<caption>Table2</caption>
<tr>
<th>Attribute Name</th><th>Description</th><th>Optional/Mandatory</th>
</tr>
<tr>
<td>name</td><td>Servlet name</td><td>Mandatory</td>
</tr>
<tr>
<td>pathSpec</td><td>Path specification: what URLs to bind to this servlet</td><td>Mandatory</td>
</tr>
<tr>
<td>ClassName</td><td>Class name for the servlet</td><td>Mandatory</td>
</tr>
<tr>
<td>initParams</td><td>Vector of Initialisation parameters </td><td>Optional</td>
</tr>
<tr>
<td>initOrder</td><td>Order for servlet initialisation. &lt;0 means "on demand"; servlets with a value &gt;0 are executed in order</td><td>Optional, default is -1</td>
</tr>
<tr>
<td>mappings</td><td>Mappings (e.g. ["*.jsp","*.jspx"]</td><td>Optional</td>
</tr>
</table>
<p class="Text body"></p>
<p class="Text body">Run-time properties</p>
<table class="ForrestTable" cellspacing="1" cellpadding="4">
<caption>Table8</caption>
<tr>
<th>Attribute Name</th><th>Description</th>
</tr>
<tr>
<td>absolutePath</td><td>Base path of this context. This is the concatenation of the servlet context which the servlet is deployed into with the servlet's pathSpec, with any trailing * stripped off the end of the latter. It is not valid for filename based mappings such as pathspec "*.do"; </td>
</tr>
</table>
<p class="Text body"></p>
<a name="N101D1"></a><a name="-N101D1"></a>
<h4></h4>
<a name="N101D5"></a><a name="LivenessPage"></a>
<h4>LivenessPage</h4>
<p class="Text body">The liveness page retrieves a web page on a liveness check. If the retrieval fails, an exception is thrown. This component is completely implemented in the services/www package. </p>
<p class="Code">LivenessPageSchema extends Schema {</p>
<p class="Code"></p>
<p class="Code">//either</p>
<p class="Code">//full URL to the page</p>
<p class="Code">url extends OptionalString;</p>
<p class="Code">//or</p>
<p class="Code">//port of the page; default 80</p>
<p class="Code">port extends OptionalInteger;</p>
<p class="Code">//host of the page; default 127.0.0.1</p>
<p class="Code">host extends OptionalString;</p>
<p class="Code">//protocol, default http</p>
<p class="Code">protocol extends OptionalString;</p>
<p class="Code">//page</p>
<p class="Code">page extends OptionalString;</p>
<p class="Code">//query list of things that get turned into queries -without escaping.</p>
<p class="Code">queries extends OptionalVector;</p>
<p class="Code"></p>
<p class="Code">//and any of</p>
<p class="Code"></p>
<p class="Code">//flag to set if you want any error text fetched from</p>
<p class="Code">//the remote site. This is good for diagnostics.</p>
<p class="Code">fetchErrorText extends OptionalBoolean;</p>
<p class="Code">//response code below which the fetch is an error</p>
<p class="Code">minimumResponseCode extends OptionalInteger;</p>
<p class="Code">//error code above which an error has occurred,</p>
<p class="Code">//default is 299.</p>
<p class="Code">maximumResponseCode extends OptionalInteger;</p>
<p class="Code">//flag to follow redirects</p>
<p class="Code">followRedirects extends OptionalBoolean;</p>
<p class="Code">//check frequency. This is the number of pings between checks</p>
<p class="Code">//and so lets us probe less often than normal. default=1</p>
<p class="Code">checkFrequency extends OptionalInteger;</p>
<p class="Code"></p>
<p class="Code">//flag to say that the check is on/off; useful during development</p>
<p class="Code">enabled extends OptionalBoolean;</p>
<p class="Code last line">}</p>
<p class="Text body">The liveness page component does not deploy anything, but whenever a liveness check is made of it, it will attempt to synchronously download a page from the web server.</p>
<p class="Text body">The component can either be configured with a full URL to a page, or by specifically configuring the hostname, port, protocol and page of a URL, along with an optional vector of query strings. </p>
<p class="Text body">Note that "localhost" , "127.0.0.1" and the IPv6 equivalent "::1/128" all bind to loopback address of a system, not to any external interface of a server. As loopback interfaces are normally not firewall protected, probing for pages over the loopback address does not verify that a firewall is not interfering with remote access to a page. To verify that a page is remotely accessible, the best techniques are either deploy the checker to a remote host, or to relay the request via an HTTP proxy. This component uses the current proxy of the JVM, so will go via proxy if the JVM is so configured.</p>
<table class="ForrestTable" cellspacing="1" cellpadding="4">
<caption>Table1</caption>
<tr>
<th>Attribute Name</th><th>Description</th><th>Optional/Mandatory</th>
</tr>
<tr>
<td>url</td><td>Complete URL to retrieve. e.g. "http://smartfrog.org/"</td><td>Mandatory unless page is set.</td>
</tr>
<tr>
<td>port</td><td>Port to probe. Only used if url is not set.</td><td>Optional-default=80</td>
</tr>
<tr>
<td>host</td><td>Host to probe. Only used if url is not set.</td><td>Optional -default "127.0.0.1"</td>
</tr>
<tr>
<td>protocol</td><td>Protocol to use -anything supported by java.net.URL is allowed. Only used if url is not set.</td><td>Optional -default="http"</td>
</tr>
<tr>
<td>page</td><td>Page under a host to probe. Only used if url is not set.</td><td>Mandatory unless url is set</td>
</tr>
<tr>
<td>queries</td><td>A vector of name-value pairs that are used to build a query string. For example, ["size","200","owner",LAZY owner"] could be turned into the query string"?size=200&amp;owner=something", assuming that LAZY owner resolved to "something".There is currently NO ESCAPING of strings in this query.</td><td>Optional, default=null</td>
</tr>
<tr>
<td>fetchErrorText</td><td>Boolean flag to indicate that the response text should be received when there is an error.</td><td>Optional -default=true</td>
</tr>
<tr>
<td></td><td>These two values define the range of HTTP response codes that constitute a successful fetch. By default, the range 200&lt;=299 is deemed a success</td><td></td>
</tr>
<tr>
<td>followRedirects</td><td>Boolean that controls whether redirects (3XX codes) should be followed</td><td>Optional</td>
</tr>
<tr>
<td>checkFrequency</td><td>Frequency of checking the page; allows HTTP pages to be checked less often than other liveness pages. This is useful if the check is slow or CPU-intensive on the server.</td><td>Optional -default=1</td>
</tr>
<tr>
<td>Enabled</td><td>Boolean to enable/disable checking</td><td>Optional -default=true</td>
</tr>
</table>
<p class="Text body"></p>
<p class="Text body"></p>
<p class="Text body">Future enhancements, for which contributions are encouraged, include</p>
<p class="P3">asynchronous retrieval of pages</p>
<p class="P3">Post-download validation. This could be declaring a minimum size of a page, or a required mime type</p>
<p class="P3">XML validation and parsing of a downloaded document. At its most sophisticated, XPath expressions could be resolved against the downloaded content and turned into resolvable attributes. This would enable run-time extraction of content from XML messages.</p>
<p class="P3">POST support and url-forms-encoded encoding of the query string.</p>
<p class="P3">escaping of GET query parameters.</p>
<p class="Text body"></p>
<a name="N102BB"></a><a name="ServletContext+Components"></a>
<h3 class="boxed">ServletContext Components</h3>
<p class="Text body">These are components that are only valid when bound to a servlet context.</p>
<a name="N102C3"></a><a name="MimeType"></a>
<h4>MimeType</h4>
<p class="Text body">Declares a mime type within a servlet context. The mime type is removed when the application is undeployed.</p>
<table class="ForrestTable" cellspacing="1" cellpadding="4">
<caption>Table9</caption>
<tr>
<th>Attribute Name</th><th>Description</th><th>Optional/Mandatory</th>
</tr>
<tr>
<td>extension</td><td>Extension, e.g. "*.html"</td><td>Mandatory</td>
</tr>
<tr>
<td>type</td><td>Mime type, e.g. "text/html"</td><td>Mandatory</td>
</tr>
<tr>
<td>context</td><td>Reference to a servlet context e.g.LAZY PARENT:servlets</td><td>Mandatory</td>
</tr>
</table>
<p class="Text body"></p>
<p class="Text body"></p>
</div>
</div>
<div class="clearboth">&nbsp;</div>
</div>
<div id="footer">
<div class="lastmodified">
<script type="text/javascript"><!--
document.write("<text>Last Published:</text> " + document.lastModified);
//  --></script>
</div>
<div class="copyright">
        Copyright &copy;
         2005 Hewlett Packard Company</div>
<div class="host">
<a href="http://sourceforge.net/projects/smartfrog"><img class="logoImage" alt="" src="images/sourceforge.gif"></a>
</div>
</div>
</body>
</html>
