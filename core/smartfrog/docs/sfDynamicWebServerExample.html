<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta content="Apache Forrest" name="Generator">
<meta name="Forrest-version" content="0.7">
<meta name="Forrest-skin-name" content="pelt">
<title>SmartFrog Dynamic Web Server Example</title>
<link type="text/css" href="skin/basic.css" rel="stylesheet">
<link media="screen" type="text/css" href="skin/screen.css" rel="stylesheet">
<link media="print" type="text/css" href="skin/print.css" rel="stylesheet">
<link type="text/css" href="skin/profile.css" rel="stylesheet">
<script src="skin/getBlank.js" language="javascript" type="text/javascript"></script><script src="skin/getMenu.js" language="javascript" type="text/javascript"></script><script src="skin/fontsize.js" language="javascript" type="text/javascript"></script>
<link rel="shortcut icon" href="">
</head>
<body onload="init()">
<script type="text/javascript">ndeSetTextSize();</script>
<div id="top">
<div class="breadtrail">
<script src="skin/breadcrumbs.js" language="JavaScript" type="text/javascript"></script>
</div>
<div class="header">
<div class="grouplogo">
<a href="http://www.SmartFrog.org/"><img class="logoImage" alt="SmartFrog" src="images/group.png" title="SmartFrog"></a>
</div>
<div class="projectlogoA1">
<a href="http://www.SmartFrog.org"><img class="logoImage" alt="" src="images/frog.gif"></a>
</div>
<ul id="tabs">
<li>
<a class="base-not-selected" href="index.html">Home</a>
</li>
<li>
<a class="base-not-selected" href="sfcore.html">SmartFrog Core</a>
</li>
<li>
<a class="base-not-selected" href="comp.html">Components</a>
</li>
<li>
<a class="base-not-selected" href="anttasks.html">Ant Tasks</a>
</li>
<li>
<a class="base-not-selected" href="extras.html">Extras</a>
</li>
<li>
<a class="base-not-selected" href="examples.html">Examples</a>
</li>
<li>
<a class="base-not-selected" href="jdocs_index.html">Java Docs</a>
</li>
<li>
<a class="base-not-selected" href="Copyright.html">Copyright</a>
</li>
<li>
<a class="base-not-selected" href="lpgl.html">License Terms</a>
</li>
</ul>
</div>
</div>
<div id="main">
<div id="publishedStrip">
<div id="level2tabs"></div>
<script type="text/javascript"><!--
document.write("<text>Last Published:</text> " + document.lastModified);
//  --></script>
</div>
<div class="breadtrail">
             
             &nbsp;
           </div>
<div id="content">
<h1>SmartFrog Dynamic Web Server Example</h1>
<div class="abstract"></div>
<div id="minitoc-area">
<ul class="minitoc">
<li>
<a href="#Introduction">Introduction</a>
<ul class="minitoc">
<li>
<a href="#How+it+works">How it works</a>
</li>
</ul>
</li>
<li>
<a href="#Running+The+Example">Running The Example</a>
<ul class="minitoc">
<li>
<a href="#Configuration">Configuration</a>
</li>
<li>
<a href="#Command+line+options">Command line options</a>
</li>
<li>
<a href="#Tuning+the+demo">Tuning the demo</a>
</li>
</ul>
</li>
<li>
<a href="#Driving+the+Example">Driving the Example</a>
</li>
<li>
<a href="#Exploring+the+Example">Exploring the Example</a>
</li>
</ul>
</div>
<p class="P46"></p>
<p class="P47"></p>
<p class="P47"></p>
<p class="P47"></p>
<p class="P47"></p>
<p class="P47"></p>
<p class="P47"></p>
<p class="P1">A Brief Description of the Dynamic Web Server Demonstrator</p>
<p class="P48">
<a class="external" href="http://www.smartfrog.org/"></a>
</p>
<p class="P49">
<a class="external" href="http://www.smartfrog.org/">www.smartfrog.org</a><a class="external" href="http://www.smartfrog.org/"> </a>
</p>
<p class="P50"></p>
<p class="P51"></p>
<p class="P52"></p>
<p class="Heading">Table Of Contents</p>
<p class="Text body"></p>
<p class="P7"></p>
<a name="N10039"></a><a name="Introduction"></a>
<h2 class="boxed">Introduction</h2>
<div class="section">
<p class="instruction">The Dynamic Web Example is an example of an adaptive application built using SmartFrog. The concept is relatively simple, in that the system implements a web server that adapts to load by deploying or removing web servers according to the load.</p>
<p class="instruction">
<img alt="Graphic7" src="openOfficeEmbeddedImage/zip-sfDynamicWebServerExample.sxw/file-Pictures/10000000000002D00000021C35ED72E7.gif"></p>
<p class="instruction">
<img alt="Graphic8" src="openOfficeEmbeddedImage/zip-sfDynamicWebServerExample.sxw/file-Pictures/10000000000002D00000021CDBCDF87B.gif"></p>
<p class="instruction">The diagram above is an outline of the various parts of the demonstrator. The three main parts, described as different SmartFrog templates, are the core service (the service manager and the load balancer), the web server(s), and the load generators that are provided so as to provide sufficient simulated load to cause the service to have to adapt.</p>
<a name="N1004E"></a><a name="How+it+works"></a>
<h3 class="boxed">How it works</h3>
<p class="Text body">The first part that must be created is the service manager and the load balancer. When this template is deployed, a number of graphical components will appear on the screen. </p>
<p class="Text body">On the service manager host, a graph will appear which shows the response time of the active measurements made on the web servers through the load balancer. There are two threshold bars on this graph &ndash; the upper one indicating the worst case response before a new web server must be created. The lower one indicates the level of performance at which point it may be OK to terminate one of the web servers and free up the resource.</p>
<p class="Text body">On the load balancer hosts, a bar graph will appear which shows the number of connections that the load balancer has handled in the last time period. There are an upper and lower tide-mark bars which show the maximum and minimum values reached over the last minute or so.</p>
<p class="Text body">As the service manager starts, it looks for the minimum web-servers configuration attribute, and deploys the requisite number on the set of server hosts. The service manager does not actually understand the concept of a web service, it simply deploys a template that it is given as a configuration attribute. The service could just as easily be a database, or a gaming service, or some other. The service that is created depends only on the configuration parameter.</p>
<p class="Text body">As the web server is deployed, a number of steps are defined. Firstly a workflow is started (as indicated by a progress bar graphic that appears on the selected server host). The workflow has a number of steps.</p>
<ul>
<li>
<p class="P55">a tarball containing the apache distribution is downloaded from the configured location</p>
</li>
<li>
<p class="P55">this is expanded and build and the install scripts run</p>
</li>
<li>
<p class="P55">a tarball containing some cgi-bin scripts is downloaded and expanded</p>
</li>
<li>
<p class="P55">a tarball containing some web pages is downloaded and expanded</p>
</li>
</ul>
<p class="Text body">At this point the installation workflow is complete and the Apache management components can be started. As these are deployed, a couple of graphs appear that show the CPU load in the server and the number of Apache threads that are running to handle the load. These are provided as visual feedback to show how heavily the server is loaded.</p>
<p class="Text body">A set of load generators, controlled by a slider, can be deployed and this used to drive the load on the servers. As the load is increased, the servers will start to get loaded, and this can be observed through the graphs.</p>
<p class="Text body">If the response graph moves above the upper threshold, this will trigger another web server if there is a free server node. If the response moves below the lower threshold, this will trigger the release of a web server if this does not violate the minimum server requirement.</p>
<p class="Text body"></p>
</div>
<a name="N1007E"></a><a name="Running+The+Example"></a>
<h2 class="boxed">Running The Example</h2>
<div class="section">
<a name="N10083"></a><a name="Configuration"></a>
<h3 class="boxed">Configuration</h3>
<p class="Text body">This section describes how to configure the dynamic web server demonstrator. </p>
<p class="Text body">Most of the key files to run the demonstrator are in the sf directory, and in particular the file system.sf contains the top-level definition of the "sfConfig" description, plus the attributes that can be changed to vary the way in which the demonstrator deploys and runs.</p>
<p class="Text body">There is a certain amount of preparation to do before starting.</p>
<p class="Text body">1) Locate a number of nodes on which the demonstration will run - ideally this will be five: four for the server components and the one from which the simulated load will be generated and the application descriptions launched. Each of these should have a display so that the various graphs can be seen.</p>
<p class="Text body">A fewer number of nodes can be used, but the displays will then get confused. Additional ones can also be used, but with no real additional purpose. </p>
<p class="Text body">The nodes used for the web servers must be x86, running Linux. The version of Apache that will be installed is an old one - we leave it as an exercise to modify this for a more recent version.</p>
<ol>
<li>
<p class="P56">Each of these nodes should have the SmartFrog release installed,and the daemon started.</p>
</li>
<li>
<p class="P56">The file org/smartfrog/examples/sf/system.sf should be edited to define a mapping between the physical nodes and the node attributes used in the descriptions. </p>
</li>
<li>
<p class="P56">As Apache is installed, a number of tar files will be downloaded. These tar files have been made available on the Internet at the &ldquo;www.smartfrog.org&rdquo; website. </p>
</li>
<li>
<p class="P56">The configuration descriptions have been defined to use these tar files, however it would generally be better to download these in advance and place them on a local server so that the communication is more reliable and the performance improved. For example the Apache download is approximately 30MB, this will be slow to download across the Internet.</p>
</li>
<li>
<p class="P56">Edit the &ldquo;org/smartfrog/examples/dynamicwebserver/sf/system.sf&rdquo; file to define where the web server holding these three tar files are located. </p>
</li>
</ol>
<a name="N100AF"></a><a name="Command+line+options"></a>
<h3 class="boxed">Command line options</h3>
<p class="Text body">To run the demonstrator, there are a number of possibilities</p>
<ul>
<li>
<p class="P57">to launch the whole demo - the web service and the load generators</p>
</li>
<li>
<p class="P57">to launch just the service, and not the load generators</p>
</li>
<li>
<p class="P57">to launch only the load generators, perhaps to add additional load to an existing web service</p>
</li>
</ul>
<p class="Text body">The system.sf file contains an sfConfig definition that contains the two parts: the service and the load generators. Consequently either the entire sfConfig is used, or the two constituent components of sfConfig can be use separately. The command lines for the three alternatives would be as follows:</p>
<p class="Text body">smartfrog -a wsAll:DEPLOY:system.sf::localhost: -e</p>
<p class="Text body">smartfrog -a ws:DEPLOY:system.sf:service:localhost: -e</p>
<p class="Text body">smartfrog -a lg:DEPLOY:system.sf:loadGenerators:localhost: -e</p>
<p class="Text body">The first could also be done using the simplified sfStart script</p>
<p class="Text body">sfStart localhost wsAll system.sf</p>
<a name="N100D6"></a><a name="Tuning+the+demo"></a>
<h3 class="boxed">Tuning the demo</h3>
<p class="Text body">The demo has a number of controls that allow users to tune the demonstrator so that the responsiveness of the measurements to loads, and the effect of the loads, can be adjusted.</p>
<p class="Text body">The measurements are active tests that "hit" the web server with a request for a cgi script to be executed. The time for the script to respond is measured and the result used to draw the response-time graph on the system manager.</p>
<p class="Text body">Equally, the load generator uses a possibly different cgi-script to load the server. The default settings appear to give reasonable results across a wide-range of server node types. However, if a particularly slow or fast web-server node is used, it may be impossible to either load the server sufficiently, or conversely even the measurement load may be too high. Under these circumstances, using a different cgi-script may be necessary. A variety are provided as part of the tarball, and choosing a different one (they all do an active spin for some 100s of times - a different number for each script). In general, using a long measurement script with shorter load scripts works better than the other way around.</p>
</div>
<a name="N100E4"></a><a name="Driving+the+Example"></a>
<h2 class="boxed">Driving the Example</h2>
<div class="section">
<p class="Text body">The principle of the example is that if you increase the load beyond some limit, the system will deploy a second (or subsequent) webserver. The way to increase the load is to move the slider-bar on the load-generator control component's display to the right (to a larger number). This will increase the rate at which the load generators &ldquo;hit&rdquo; the load balancer, and hence the web servers.</p>
<p class="Text body">As the load increases, a number of things can be noticed.</p>
<ol>
<li>
<p class="P58">On the load balancer connections display, the number of connections to be handled increases as shown by the increasing height of the bar.</p>
</li>
<li>
<p class="P58">On the web server, the cpu load will increase, as will the number of Apache threads that are launched to handle the increased load.</p>
</li>
<li>
<p class="P58">On the thresholder graph, the results of the active measurements will show an increase, and if this increase ever moves above the upper threshold, a new web server is launched (note that there is some deliberate lag in the decision to do so in order to avoid thrashing in the case of highly variable loadings).</p>
</li>
</ol>
<p class="Text body">If the load is decreased below the lower of the two thresholds, the system may eliminate a web server, and it will do so if the minimum number of servers will still be maintained.</p>
<p class="Text body">If insufficient load is possible with a single load generator set (although only one slider bar is visible, this controls a number of generators), a further set can be deployed (using a different name on the command line).</p>
</div>
<a name="N10102"></a><a name="Exploring+the+Example"></a>
<h2 class="boxed">Exploring the Example</h2>
<div class="section">
<p class="P6">Once the system is running, there are a number of ways of exploring the run-time system. The best way to explore the distributed components is to start the management console (this can be done from the basic display menu bar, if this is configured) or started by using the sfManagementConsole command from a shell. Details can be found in the user's manual.</p>
<p class="P6">Once the management console has been started, the application can be browsed, and the deployed components examined. As this is done, the management console will hop around the various hosts, pulling details of the distributed components. The host that is currently being accessed can be observed by examining the sfHost attribute of the current component.</p>
<p class="Text body">
<span class="T4">SmartFrog components can react to changes </span><span class="T4">in attribute values, and this demonstration reacts to changes in the value of mi</span><span class="T4">nInstances of the webThresholder component of the service template. This is the attribute which controls the minimum number of web serv</span><span class="T4">ers that must be present. For example if this is changed from the default value of 1 to 2, and there is currently only one web server deployed, a second will be deployed to meet this requirement. Similarly</span><span class="T4">, if the value is changed back to 1, a web server will be immediately terminated if it is legitimate to do so (i.e. the</span> response time for the measurements is below the lower threshold). Otherwise, the web server will only be released when it does become legitimate to do so.</p>
<p class="Text body">The web servers deployed all contain some standard pages installed as part of the Apache installation workflow. These pages are partial copies of the <a class="external" href="http://www.smartfrog.org/">www.smartfrog.org</a> web pages, but pointing a browser at the load balancer host (port 80) should result in the return of these pages and the various graphs should show signs of the activity (if this is enough to register).</p>
</div>
</div>
<div class="clearboth">&nbsp;</div>
</div>
<div id="footer">
<div class="lastmodified">
<script type="text/javascript"><!--
document.write("<text>Last Published:</text> " + document.lastModified);
//  --></script>
</div>
<div class="copyright">
        Copyright &copy;
         2005 Hewlett Packard Company</div>
<div class="host">
<a href="http://sourceforge.net/projects/smartfrog"><img class="logoImage" alt="" src="images/sourceforge.gif"></a>
</div>
</div>
</body>
</html>
